(function($){"use strict";var ResponsiveTable=function(element,options){var that=this;this.options=options;this.$tableWrapper=null;this.$tableScrollWrapper=$(element);this.$table=$(element).find("table");if(this.$table.length!==1){throw new Error("Exactly one table is expected in a .table-responsive div.")}this.$tableScrollWrapper.attr("data-pattern",this.options.pattern);this.id=this.$table.prop("id")||this.$tableScrollWrapper.prop("id")||"id"+Math.random().toString(16).slice(2);this.$tableClone=null;this.$stickyTableHeader=null;this.$thead=this.$table.find("thead");this.$tbody=this.$table.find("tbody");this.$hdrCells=this.$thead.find("th");this.$bodyRows=this.$tbody.find("tr");this.$btnToolbar=null;this.$dropdownGroup=null;this.$dropdownBtn=null;this.$dropdownContainer=null;this.$displayAllBtn=null;this.$focusGroup=null;this.$focusBtn=null;this.displayAllTrigger="display-all-"+this.id+".responsive-table";this.idPrefix=this.id+"-col-";this.iOS=isIOS();this.wrapTable();this.createButtonToolbar();this.setupHdrCells();this.setupStandardCells();if(this.options.stickyTableHeader){this.createStickyTableHeader()}if(this.$dropdownContainer.is(":empty")){this.$dropdownGroup.hide()}$(window).bind("orientationchange resize "+this.displayAllTrigger,function(){that.$dropdownContainer.find("input").trigger("updateCheck");$.proxy(that.updateSpanningCells(),that)})};ResponsiveTable.DEFAULTS={pattern:"priority-columns",stickyTableHeader:true,fixedNavbar:".navbar-fixed-top",addDisplayAllBtn:true,addDisplayBtn:true,addFocusBtn:true,focusBtnIcon:"glyphicon glyphicon-screenshot"};ResponsiveTable.prototype.wrapTable=function(){this.$tableScrollWrapper.wrap('<div class="table-wrapper"/>');this.$tableWrapper=this.$tableScrollWrapper.parent()};ResponsiveTable.prototype.createButtonToolbar=function(){var that=this;this.$btnToolbar=$('<div class="btn-toolbar" />');this.$dropdownGroup=$('<div class="btn-group dropdown-btn-group pull-right" />');if(this.options.addDisplayBtn){this.$dropdownBtn=$('<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">Display <span class="caret"></span></button>');this.$dropdownContainer=$('<ul class="dropdown-menu"/>')}$.proxy(that.activateFocus(),that);this.$bodyRows.click(function(){$.proxy(that.focusOnRow($(this)),that)});if(this.options.addDisplayAllBtn){this.$displayAllBtn=$('<button class="btn btn-default">Display all</button>');this.$dropdownGroup.append(this.$displayAllBtn);if(this.$table.hasClass("display-all")){this.$displayAllBtn.addClass("btn-primary")}this.$displayAllBtn.click(function(){$.proxy(that.displayAll(null,true),that)})}this.$dropdownGroup.append(this.$dropdownBtn).append(this.$dropdownContainer);this.$btnToolbar.append(this.$dropdownGroup);this.$tableScrollWrapper.before(this.$btnToolbar)};ResponsiveTable.prototype.clearAllFocus=function(){this.$bodyRows.removeClass("unfocused");this.$bodyRows.removeClass("focused")};ResponsiveTable.prototype.activateFocus=function(){this.clearAllFocus();if(this.$focusBtn){this.$focusBtn.toggleClass("btn-primary")}this.$table.toggleClass("focus-on")};ResponsiveTable.prototype.focusOnRow=function(row){if(this.$table.hasClass("focus-on")){var alreadyFocused=$(row).hasClass("focused");this.clearAllFocus();if(!alreadyFocused){this.$bodyRows.addClass("unfocused");$(row).addClass("focused")}}};ResponsiveTable.prototype.displayAll=function(activate,trigger){if(this.$displayAllBtn){this.$displayAllBtn.toggleClass("btn-primary",activate)}this.$table.toggleClass("display-all",activate);if(this.$tableClone){this.$tableClone.toggleClass("display-all",activate)}if(trigger){$(window).trigger(this.displayAllTrigger)}};ResponsiveTable.prototype.preserveDisplayAll=function(){var displayProp="table-cell";if($("html").hasClass("lt-ie9")){displayProp="inline"}$(this.$table).find("th, td").css("display",displayProp);if(this.$tableClone){$(this.$tableClone).find("th, td").css("display",displayProp)}};ResponsiveTable.prototype.createStickyTableHeader=function(){var that=this;that.$tableClone=that.$table.clone();that.$tableClone.prop("id",this.id+"-clone");that.$tableClone.find("[id]").each(function(){$(this).prop("id",$(this).prop("id")+"-clone")});that.$tableClone.wrap('<div class="sticky-table-header"/>');that.$stickyTableHeader=that.$tableClone.parent();that.$stickyTableHeader.css("height",that.$thead.height()+2);if($("html").hasClass("lt-ie10")){that.$tableWrapper.prepend(that.$stickyTableHeader)}else{that.$table.before(that.$stickyTableHeader)}$(window).bind("scroll resize",function(){$.proxy(that.updateStickyTableHeader(),that)});$(that.$tableScrollWrapper).bind("scroll",function(){$.proxy(that.updateStickyTableHeader(),that)})};ResponsiveTable.prototype.updateStickyTableHeader=function(){var that=this,top=0,offsetTop=that.$table.offset().top,scrollTop=$(window).scrollTop()-1,maxTop=that.$table.height()-that.$stickyTableHeader.height(),rubberBandOffset=scrollTop+$(window).height()-$(document).height(),useFixedSolution=!that.iOS,navbarHeight=0;if($(that.options.fixedNavbar).length){var $navbar=$(that.options.fixedNavbar).first();navbarHeight=$navbar.height();scrollTop=scrollTop+navbarHeight}var shouldBeVisible=scrollTop>offsetTop&&scrollTop<offsetTop+that.$table.height();if(useFixedSolution){that.$stickyTableHeader.scrollLeft(that.$tableScrollWrapper.scrollLeft());that.$stickyTableHeader.addClass("fixed-solution");top=navbarHeight-1;if(scrollTop-offsetTop>maxTop){top-=scrollTop-offsetTop-maxTop;that.$stickyTableHeader.addClass("border-radius-fix")}else{that.$stickyTableHeader.removeClass("border-radius-fix")}if(shouldBeVisible){that.$stickyTableHeader.css({visibility:"visible",top:top+"px",width:that.$tableScrollWrapper.innerWidth()+"px"});return}else{that.$stickyTableHeader.css({visibility:"hidden",width:"auto"})}}else{that.$stickyTableHeader.removeClass("fixed-solution");var animationDuration=400;top=scrollTop-offsetTop-1;if(top<0){top=0}else if(top>maxTop){top=maxTop}if(rubberBandOffset>0){top=top-rubberBandOffset}if(shouldBeVisible){that.$stickyTableHeader.css({visibility:"visible"});that.$stickyTableHeader.animate({top:top+"px"},animationDuration);that.$thead.css({visibility:"hidden"})}else{that.$stickyTableHeader.animate({top:"0"},animationDuration,function(){that.$thead.css({visibility:"visible"});that.$stickyTableHeader.css({visibility:"hidden"})})}}};ResponsiveTable.prototype.setupHdrCells=function(){var that=this;that.$hdrCells.each(function(i){var $th=$(this),id=$th.prop("id"),thText=$th.text();if(!id){id=that.idPrefix+i;$th.prop("id",id)}if(thText===""){thText=$th.attr("data-col-name")}if($th.is("[data-priority]")){var $toggle=$('<li class="checkbox-row"><input type="checkbox" name="toggle-'+id+'" id="toggle-'+id+'" value="'+id+'" /> <label for="toggle-'+id+'">'+thText+"</label></li>");var $checkbox=$toggle.find("input");that.$dropdownContainer.append($toggle);$toggle.click(function(){$checkbox.prop("checked",!$checkbox.prop("checked"));$checkbox.trigger("change")});if($("html").hasClass("lt-ie9")){$checkbox.click(function(){$(this).trigger("change")})}$toggle.find("label").click(function(event){event.stopPropagation()});$toggle.find("input").click(function(event){event.stopPropagation()}).change(function(){var $checkbox=$(this),val=$checkbox.val(),$cells=that.$tableWrapper.find("#"+val+", #"+val+"-clone, [data-columns~="+val+"]");if(that.$table.hasClass("display-all")){$.proxy(that.preserveDisplayAll(),that);that.$table.removeClass("display-all");if(that.$tableClone){that.$tableClone.removeClass("display-all")}that.$displayAllBtn.removeClass("btn-primary")}$cells.each(function(){var $cell=$(this);if($checkbox.is(":checked")){if($cell.css("display")!=="none"){$cell.prop("colSpan",parseInt($cell.prop("colSpan"))+1)}$cell.show()}else{if(parseInt($cell.prop("colSpan"))>1){$cell.prop("colSpan",parseInt($cell.prop("colSpan"))-1)}else{$cell.hide()}}})}).bind("updateCheck",function(){if($th.css("display")!=="none"){$(this).prop("checked",true)}else{$(this).prop("checked",false)}}).trigger("updateCheck")}})};ResponsiveTable.prototype.setupStandardCells=function(){var that=this;that.$bodyRows.each(function(){var idStart=0;$(this).find("th, td").each(function(){var $cell=$(this);var columnsAttr="";var colSpan=$cell.prop("colSpan");var numOfHidden=0;for(var k=idStart;k<idStart+colSpan;k++){columnsAttr=columnsAttr+" "+that.idPrefix+k;var $colHdr=that.$tableScrollWrapper.find("#"+that.idPrefix+k);var dataPriority=$colHdr.attr("data-priority");if(dataPriority){$cell.attr("data-priority",dataPriority)}if($colHdr.css("display")==="none"){numOfHidden++}}if(colSpan>1){$cell.addClass("spn-cell");if(numOfHidden!==colSpan){$cell.show()}else{$cell.hide()}}$cell.prop("colSpan",Math.max(colSpan-numOfHidden,1));columnsAttr=columnsAttr.substring(1);$cell.attr("data-columns",columnsAttr);idStart=idStart+colSpan})})};ResponsiveTable.prototype.updateSpanningCells=function(){var that=this;that.$table.find(".spn-cell").each(function(){var $cell=$(this);var columnsAttr=$cell.attr("data-columns").split(" ");var colSpan=columnsAttr.length;var numOfHidden=0;for(var i=0;i<colSpan;i++){if($("#"+columnsAttr[i]).css("display")==="none"){numOfHidden++}}if(numOfHidden!==colSpan){$cell.show()}else{$cell.hide()}$cell.prop("colSpan",Math.max(colSpan-numOfHidden,1))})};var old=$.fn.responsiveTable;$.fn.responsiveTable=function(option){return this.each(function(){var $this=$(this);var data=$this.data("responsiveTable");var options=$.extend({},ResponsiveTable.DEFAULTS,$this.data(),typeof option==="object"&&option);if(options.pattern===""){return}if(!data){$this.data("responsiveTable",data=new ResponsiveTable(this,options))}if(typeof option==="string"){data[option]()}})};$.fn.responsiveTable.Constructor=ResponsiveTable;$.fn.responsiveTable.noConflict=function(){$.fn.responsiveTable=old;return this};$(document).on("ready.responsive-table.data-api",function(){$("[data-pattern]").each(function(){var $tableScrollWrapper=$(this);$tableScrollWrapper.responsiveTable($tableScrollWrapper.data())})});$(document).on("click.dropdown.data-api",".dropdown-menu .checkbox-row",function(e){e.stopPropagation()});function mediaQueriesSupported(){return typeof window.matchMedia!=="undefined"||typeof window.msMatchMedia!=="undefined"||typeof window.styleMedia!=="undefined"}function hasTouch(){return"ontouchstart"in window}function isIOS(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))}$(document).ready(function(){$("html").removeClass("no-js").addClass("js");if(mediaQueriesSupported()){$("html").addClass("mq")}else{$("html").addClass("no-mq")}if(hasTouch()){$("html").addClass("touch")}else{$("html").addClass("no-touch")}})})(jQuery);
